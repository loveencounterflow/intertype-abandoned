// Generated by CoffeeScript 2.3.2
(function() {
  'use strict';
  var CND, alert, assign, badge, cnd_by_ity, debug, help, info, isa, ity_by_cnd, jr, rpr, self, synonyms, urge, warn, whisper;

  //###########################################################################################################
  CND = require('cnd');

  rpr = CND.rpr;

  badge = 'INTERTYPE/MAIN';

  debug = CND.get_logger('debug', badge);

  alert = CND.get_logger('alert', badge);

  whisper = CND.get_logger('whisper', badge);

  warn = CND.get_logger('warn', badge);

  help = CND.get_logger('help', badge);

  urge = CND.get_logger('urge', badge);

  info = CND.get_logger('info', badge);

  ({assign, jr} = CND);

  //-----------------------------------------------------------------------------------------------------------
  ity_by_cnd = {
    /* ??? */
    // nullorundefined:      'nullorundefined'
    // primitive:            'primitive'
    // symbol:               'symbol'
    /* TAINT object/pod distinction? */
    // object:               'object'
    pod: 'pod',
    boolean: 'boolean',
    buffer: 'buffer',
    function: 'function',
    generator: 'generator',
    generator_function: 'generatorfunction',
    infinity: 'infinity',
    jsarraybuffer: 'arraybuffer',
    jserror: 'error',
    jsglobal: 'global',
    jsnotanumber: 'nan',
    jsregex: 'regex',
    jsundefined: 'undefined',
    list: 'list',
    null: 'null',
    number: 'number',
    text: 'text'
  };

  //                 jsarguments:          'jsarguments'
  //                 jsctx:                'jsctx'
  //                 jsdate:               'jsdate'
  //                 jswindow:             'jswindow'
  cnd_by_ity = {};

  //-----------------------------------------------------------------------------------------------------------
  // @boolean              = CND.isa_boolean
  // @buffer               = CND.isa_buffer
  // @function             = CND.isa_function
  // @generator            = CND.isa_generator
  // @generatorfunction    = CND.isa_generator_function
  // @infinity             = CND.isa_infinity
  // # @jsarguments          = CND.isa_jsarguments
  // @arraybuffer        = CND.isa_jsarraybuffer
  // @nodejs_buffer             = CND.isa_jsbuffer
  // # @jsctx                = CND.isa_jsctx
  // # @jsdate               = CND.isa_jsdate
  // @error              = CND.isa_jserror
  // @global             = CND.isa_jsglobal
  // @nan         = CND.isa_jsnotanumber
  // @regex              = CND.isa_jsregex
  // @undefined          = CND.isa_jsundefined
  // # @jswindow             = CND.isa_jswindow
  // @list                 = CND.isa_list
  // @null                 = CND.isa_null
  // @nullorundefined      = CND.isa_nullorundefined
  // @number               = CND.isa_number
  // ### TAINT object/pod distinction? ###
  // @object               = CND.isa_object
  // @pod                  = CND.isa_pod
  // @primitive            = CND.isa_primitive
  // @symbol               = CND.isa_symbol
  // @text                 = CND.isa_text

  //===========================================================================================================

  //-----------------------------------------------------------------------------------------------------------
  this.type_of = function(x) {
    var arity, ref, type;
    if ((arity = arguments.length) !== 1) {
      throw new Error(`µ63000 expected 1 argument, got ${arity}`);
    }
    return (ref = ity_by_cnd[type = CND.type_of(x)]) != null ? ref : type;
  };

  //-----------------------------------------------------------------------------------------------------------
  this.validate = function(x, type, message = null) {
    var tester;
    if ((tester = this[type]) == null) {
      throw new Error(`µ63077 unknown type ${rpr(type)}`);
    }
    if (!tester(x)) {
      throw new Error(message != null ? message : `µ63154 expected a ${type}, got a ${CND.type_of(x)}`);
    }
    return null;
  };

  //===========================================================================================================

  //-----------------------------------------------------------------------------------------------------------
  // function_types    = new Set [ 'generatorfunction', 'generator', 'asyncfunction', ]
  // @function         = ( x ) -> function_types.has ( @isa x )
  // @proper_function  = ( x ) -> @isa x )
  //-----------------------------------------------------------------------------------------------------------
  synonyms = {
    string: 'text'
  };

  //-----------------------------------------------------------------------------------------------------------
  this.extensions = {
    boundfunction: 'function',
    generator: 'function',
    generatorfunction: 'function',
    asyncfunction: 'function'
  };

  //-----------------------------------------------------------------------------------------------------------
  this.extends = function(subtype, supertype) {
    var type;
    if (arity !== 2) {
      /* TAINT use validation functions with arguments */
      throw new Error(`µ63231 expected 2 arguments, got ${arity}`);
    }
    if ((type = this.type_of(subtype)) !== 'text') {
      throw new Error(`µ63308 expected a text, got a ${type}`);
    }
    if ((type = this.type_of(supertype)) !== 'text') {
      throw new Error(`µ63385 expected a text, got a ${type}`);
    }
    if (subtype === supertype) {
      return true;
    }
    return this[subtype] === supertype;
  };

  //===========================================================================================================
  // LISTS
  //-----------------------------------------------------------------------------------------------------------
  this.first_of = function(collection) {
    return collection[0];
  };

  this.last_of = function(collection) {
    return collection[collection.length - 1];
  };

  //===========================================================================================================
  // OBJECT SIZES
  //-----------------------------------------------------------------------------------------------------------
  this.size_of = function(x, settings) {
    var ref, ref1, selector, type;
    switch (type = CND.type_of(x)) {
      case 'list':
      case 'arguments':
      case 'buffer':
        return x.length;
      case 'text':
        switch (selector = (ref = settings != null ? settings['count'] : void 0) != null ? ref : 'codeunits') {
          case 'codepoints':
            return (Array.from(x)).length;
          case 'codeunits':
            return x.length;
          case 'bytes':
            return Buffer.byteLength(x, (ref1 = settings != null ? settings['encoding'] : void 0) != null ? ref1 : 'utf-8');
          default:
            throw new Error(`unknown counting selector ${rpr(selector)}`);
        }
        break;
      case 'set':
      case 'map':
        return x.size;
    }
    if (CND.isa_pod(x)) {
      return (Object.keys(x)).length;
    }
    throw new Error(`unable to get size of a ${type}`);
  };

  //===========================================================================================================

  //-----------------------------------------------------------------------------------------------------------
  this.all_own_keys_of = function*(x) {
    var i, k, len, ref, results;
    if (x == null) {
      return;
    }
    ref = Object.getOwnPropertyNames(x);
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      k = ref[i];
      results.push((yield k));
    }
    return results;
  };

  //-----------------------------------------------------------------------------------------------------------
  this.all_keys_of = function(x, include_object = false) {
    return this._all_keys_of(x, new Set(), include_object);
  };

  //-----------------------------------------------------------------------------------------------------------
  this._all_keys_of = function*(x, seen, include_object = false) {
    var k, proto, ref;
    if ((!include_object) && x === Object.prototype) {
      return;
    }
    ref = this.all_own_keys_of(x);
    // debug 'µ23773', ( rpr x ), ( x:: )
    for (k of ref) {
      if (seen.has(k)) {
        continue;
      }
      seen.add(k);
      yield k;
    }
    if ((proto = Object.getPrototypeOf(x)) != null) {
      return (yield* this._all_keys_of(proto, seen, include_object));
    }
  };

  //-----------------------------------------------------------------------------------------------------------
  this.keys_of = function*(x) {
    var k, results;
    results = [];
    for (k in x) {
      results.push((yield k));
    }
    return results;
  };

  this.values_of = function(x) {
    return [...x];
  };

  //-----------------------------------------------------------------------------------------------------------
  isa = function(x, type) {
    var arity, tester;
    if ((arity = arguments.length) === 1) {
      return this.type_of(x);
    }
    if (arity !== 2) {
      throw new Error(`µ63462 expected 2 arguments, got ${arity}`);
    }
    if ((type = this.type_of(type)) !== 'text') {
      throw new Error(`µ63539 expected a text, got a ${type}`);
    }
    if ((tester = this[type]) == null) {
      throw new Error(`µ63616 unknown type ${rpr(type)}`);
    }
    return tester(x);
  };

  //-----------------------------------------------------------------------------------------------------------
  // debug 'µ38873', @
  // debug 'µ38873', @isa
  // return @

  //###########################################################################################################
  self = this;

  isa = isa.bind(this);

  module.exports = isa;

  (function() {
    var cnd_key, cnd_method, cnd_type, ity_type, key, type, value;
//---------------------------------------------------------------------------------------------------------
    for (cnd_type in ity_by_cnd) {
      ity_type = ity_by_cnd[cnd_type];
      //.......................................................................................................
      /* Generate entries to cnd_by_ity: */
      /* TAINT should check for name clashes */
      cnd_by_ity[ity_type] = cnd_type;
      //.......................................................................................................
      /* Generate mappings from `isa.$type()` to CND.isa_$type()`: */
      cnd_key = `isa_${cnd_type}`;
      // debug 'µ8498', cnd_type, ity_type, cnd_key, CND.type_of CND[ cnd_key ]
      if ((type = CND.type_of((cnd_method = CND[cnd_key]))) !== 'function') {
        throw new Error(`µ63693 expected a function for \`CND.${cnd_key}\`, found a ${type}`);
      }
      self[ity_type] = cnd_method.bind(CND);
    }
//---------------------------------------------------------------------------------------------------------
/* Bind all functions to `module.exports`: */
    for (key in self) {
      value = self[key];
      /* TAINT use isa_callable */
      if (CND.isa_function(value)) {
        isa[key] = value.bind(isa);
      } else {
        isa[key] = value;
      }
    }
    //---------------------------------------------------------------------------------------------------------
    return null;
  })();

}).call(this);

//# sourceMappingURL=main.js.map
